<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>PFSense with Multiple Public IPs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.38.2" />
  <link href="" rel="alternate" type="application/rss+xml" title="Tiernan&#39;s Comms Closet" />
  <link href="http://localhost:1313//css/bootstrap.min.css" rel="stylesheet">
  <link href="http://localhost:1313//css/hc.css" rel="stylesheet">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  
    
    </head>
    <body>
<div class="nav-toggle"><i class="fa fa-bars fa-2x"></i> Herring Cove </div>
      <div id = "wrapper">


<div class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="http://localhost:1313//"><p class="navbar-brand">Tiernan&#39;s Comms Closet</p></a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
					
					
          </ul>
        </div>
      </div>
    </div>



       
       <div id="sidebar-wrapper">
        <ul class="sidebar-nav">
					<img src="" />
          <li class="sidebar-brand"><a href="http://localhost:1313//"><h1 class="brand">Tiernan&#39;s Comms Closet</h1></a><h3></h3></li>
          <hr />
					
          <hr />
          <div id="social-wrapper">
           
           
           
           
         </div>
       </ul>
     </div>



     <div class="container">


  <div id="article">
   <div class="article-title">PFSense with Multiple Public IPs</div>
   <p class="meta"><small>&nbsp;<i class="fa fa-calendar-o"></i> 2015-05-30</small></p> <hr/>
   <div class="post">
     <p>So, a few weeks back, i got my hands on a <a href="http://www.hetzner.de/en">Hetzner</a> Dedicated box. It has a quad core Xeon, 32Gb ram, 3x3Tb hdds, RAID controller and KVMoIP. one of the first thing i did was get myself a /29 IP pool (8 total, 6 usable IPs). There where already 3 IPs given to me: 1 for the KVM, one for the box itself, and 1 as the router for the IP block.</p>

<p>So, i need to setup my own router, so i picked <a href="http://www.pfsense.org">PFSense</a> since its what i run in house. I gave it 2 network connections: 1 connected to the main network adapter on the VMWare ESXi box (public) and one to a virtual switch, which is only used by VMs. The public is the WAN link and it gets a static IP from Hetzner, and the virtual switch is then my &ldquo;LAN&rdquo; link. This allows me to have standard NATed network connections to any VM i have, but then, what do i do with those IPs?</p>

<p>So, after a lot of digging, i found the answer. So, this should help.</p>

<ul>
<li>Under firewall, click on Virtual IPs.</li>
<li>click the plus. I then selected IP alias, selected the WAN interface and set the IP to my first public IP i wanted to give. in my case, i was given a /29 block, and my first address was 176. This is the network address. I used 177. Likewise, my last address is 183, but that cannot be used either as its a broadcast address. give it a description and then hit OK. Repease for all IPs you want to use. TIP: Give each a meaningful description!</li>
<li>Next, click firewall, NAT and 1:1. Click the add button and select your interface as WAN. set the External Subnet IP as the one you want to use and your internal IP as the machine that will have it. Thats all i did on that screen&hellip;</li>
<li>Then go to Firewall, NAT, outbound&hellip; this is where things got complicated. Set the mode to &ldquo;Manual outbound NAT rule generation (AON - Advanced Outbound NAT)&rdquo; and click save.</li>
<li>Then create a new rule: Interface: WAN, Source, Network, IP of the internal machine and then under translation, under address select the IP you want to give it. If you followed my tip in step 2, you should see the descriptions in here.</li>
</ul>

<p>After saving everything and reloading the firewall, visiting a page like <a href="http://www.whatsmyip.org">WhatsMyIP</a> or <a href="http://icanhazip.com">ICanHazIP</a> should show you your public IP. You can then create firewall rules to allow access. Quick idea would be:</p>

<p>Firewall/Rules, Add, Interface WAN, Destination: Local IP you want to use, and give whatever &ldquo;normal&rdquo; rules you would (HTTP, lock down to source address, etc). Click apply and hitting that address using what ever method (SSH, HTTP, etc) should work.</p>

<p>YMMV, but hopefully this helps! Any questions, leave a comment.</p>

   </div>
 </div>


 <a href="https://twitter.com/share" class="twitter-share-button " data-size="small" data-count="none">Tweet</a>
 <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

 <ul class="pager">
      &nbsp;<li class="previous"><a href="http://localhost:1313/2015/06/14/Network-and-Homelab-V.Next-Part-1/"> Network and Homelab V.Next (Part 1)</a></li>
      &nbsp;<li class="next"><a href="http://localhost:1313/2015/05/20/Quick-tip-for-internet-facing-ESXi-servers/"> Quick tip for internet facing ESXi servers</a></li>
</ul>



    </ul>
    </div>
    <footer>

        <p class="text-muted credit">&copy; 2018. All rights reserved. </p>
    </footer>
 
    <script src="http://localhost:1313//js/jquery-1.10.2.min.js"></script>
    <script src="http://localhost:1313//js/bootstrap.min.js"></script>
    <script src="http://localhost:1313//js/bootstrap.js"></script>
    <script type="text/javascript" src="http://localhost:1313//js/hc.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>

</html>

