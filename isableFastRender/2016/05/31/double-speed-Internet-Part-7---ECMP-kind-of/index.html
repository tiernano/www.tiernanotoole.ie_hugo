<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>double speed Internet Part 7 - ECMP (kind of)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.38.2" />
  <link href="" rel="alternate" type="application/rss+xml" title="Tiernan&#39;s Comms Closet" />
  <link href="http://localhost:1313//css/bootstrap.min.css" rel="stylesheet">
  <link href="http://localhost:1313//css/hc.css" rel="stylesheet">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  
    
    </head>
    <body>
<div class="nav-toggle"><i class="fa fa-bars fa-2x"></i> Herring Cove </div>
      <div id = "wrapper">


<div class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="http://localhost:1313//"><p class="navbar-brand">Tiernan&#39;s Comms Closet</p></a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
					
					
          </ul>
        </div>
      </div>
    </div>



       
       <div id="sidebar-wrapper">
        <ul class="sidebar-nav">
					<img src="" />
          <li class="sidebar-brand"><a href="http://localhost:1313//"><h1 class="brand">Tiernan&#39;s Comms Closet</h1></a><h3></h3></li>
          <hr />
					
          <hr />
          <div id="social-wrapper">
           
           
           
           
         </div>
       </ul>
     </div>



     <div class="container">


  <div id="article">
   <div class="article-title">double speed Internet Part 7 - ECMP (kind of)</div>
   <p class="meta"><small>&nbsp;<i class="fa fa-calendar-o"></i> 2016-05-31</small></p> <hr/>
   <div class="post">
     <p>[NOTE] This part 7 in a series of posts. The rest can be found <a href="https://www.tiernanotoole.ie/tag/Double_Internet/">here</a>.</p>

<p>In the <a href="https://www.tiernanotoole.ie/2016/05/17/double-speed-internet-part-6-hetzner-edition.html">last post</a> I mentioned I am now using <a href="http://www.hetzner.de/en">Hetzner</a> for hosting a dedicated box. Thats still live, and going well. I have a /29 IP range (6 usable) and also 2 other IPs. So far, so good&hellip; But because i was using a Socks Server, I was not fully able to use the /29 ips&hellip; I use something like as follows:</p>

<script src="https://gist.github.com/tiernano/68894593dd44acb4820617aef2889fd6.js"></script>

<p>essentially, for each public IP i have that i want to map to an internal IP, i have a POST and PRE ROUTING rule, plus the required forward rules&hellip; But, if socks are used, then that goes out the Window, since TCP traffic will look like its coming from the socks server&hellip; So, i killed the socks server, removed the IPTables rule, and then realized that while outgoing traffic was being balanced somewhat (2 default rules on the internal box pointing at the OpenVPN IPs from the Hetzner box) incoming was a problem. Hetzner knew how to get to my internal network, but only though one ip&hellip; enter Quagga and Zebra&hellip;</p>

<p><a href="http://www.nongnu.org/quagga/">Quagga</a> is a routing software suite, which can do protocols like OSPF, BGP and RIP, and Zebra is the component that does static routing. using their <a href="http://www.nongnu.org/quagga/docs/docs-info.html#Static-Route-Commands">documentation on static routes</a>, I created a static route to my internal network with 2 next hops, the OVPN IPs from the internal box&hellip; and, after restarting Quagga, all works! happy days! now i can forward ips from outside the network to inside the network correctly, and they look like they are the public ip!</p>

<p>So, whats next then? well, I now have a server in Germany (Hetzner) and one in France (<a href="http://www.ovh.com">OVH</a>), and can spin one up in the UK or the US (<a href="https://m.do.co/c/d4d345b83b55">Digital Ocean</a>). Given that i have Quagga running on the box, i am now thinking of trying to see if its possible to route traffic depending on distance or something similar&hellip; If i am trying to hit a server in Hetzner&rsquo;s DC, i should go though Germany. If its in Digital Ocean, go though either US or UK servers, same with OVH. Then figure out who has the fastest links to, say, Amazon, Azure, Netflix, BBC, Dropbox, etc, and add either static or dynamic links to the router&hellip; essentially, thats the theory&hellip; lets see how that works&hellip;</p>

   </div>
 </div>


 <a href="https://twitter.com/share" class="twitter-share-button " data-size="small" data-count="none">Tweet</a>
 <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

 <ul class="pager">
      &nbsp;<li class="previous"><a href="http://localhost:1313/2016/06/08/double-speed-Internet-Part-8---Routing-Around/"> double speed Internet Part 8 - Routing Around</a></li>
      &nbsp;<li class="next"><a href="http://localhost:1313/2016/05/17/double-speed-Internet-Part-6---Hetzner-Edition/"> double speed Internet Part 6 - Hetzner Edition</a></li>
</ul>



    </ul>
    </div>
    <footer>

        <p class="text-muted credit">&copy; 2018. All rights reserved. </p>
    </footer>
 
    <script src="http://localhost:1313//js/jquery-1.10.2.min.js"></script>
    <script src="http://localhost:1313//js/bootstrap.min.js"></script>
    <script src="http://localhost:1313//js/bootstrap.js"></script>
    <script type="text/javascript" src="http://localhost:1313//js/hc.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>

</html>

